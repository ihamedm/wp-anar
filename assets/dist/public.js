/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./assets/js/public.js":
/*!*****************************!*\
  !*** ./assets/js/public.js ***!
  \*****************************/
/***/ (() => {

eval("jQuery(document).ready(function ($) {\n  var tooltip = jQuery('<div class=\"awca-tooltip\" style=\"position: absolute; background-color: black; color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; display: none; z-index: 1000;\"></div>');\n  jQuery('body').append(tooltip);\n\n  // Use event delegation to handle mouseenter and mouseleave\n  jQuery(document).on('mouseenter', '.awca-tooltip-on', function () {\n    // Get the title attribute\n    var title = jQuery(this).attr('title');\n    // Set the tooltip text\n    tooltip.text(title);\n\n    // Calculate the right offset for the tooltip\n    var elementRightOffset = jQuery(this).offset().left + jQuery(this).outerWidth();\n    var tooltipWidth = tooltip.outerWidth();\n    tooltip.css({\n      display: 'block',\n      left: elementRightOffset - tooltipWidth + 'px',\n      top: jQuery(this).offset().top - tooltip.outerHeight() + 'px'\n    });\n  });\n  jQuery(document).on('mouseleave', '.awca-tooltip-on', function () {\n    // Hide the tooltip\n    tooltip.hide();\n  });\n  jQuery('.anar-delivery-option input[type=\"radio\"]').on('change', function () {\n    jQuery('.anar-delivery-option').removeClass('selected');\n    jQuery(this).closest('.anar-delivery-option').addClass('selected');\n  });\n  function ensureRadioSelection() {\n    $('input[type=\"radio\"][data-input-group]').each(function () {\n      var inputGroup = $(this).data('input-group');\n      var radios = $('input[data-input-group=\"' + inputGroup + '\"]');\n      // If none are checked, set the first one as checked\n\n      if (radios.filter(':checked').length === 0) {\n        radios.first().prop('checked', true);\n      }\n    });\n  }\n  function validateRadioSelectionOnOrder() {\n    $('#place_order').on('click', function (e) {\n      var allChecked = true;\n\n      // Check for each group if a radio button is checked\n      $('input[type=\"radio\"][data-input-group]').each(function () {\n        var inputGroup = $(this).data('input-group');\n        var radios = $('input[data-input-group=\"' + inputGroup + '\"]');\n        if (radios.filter(':checked').length === 0) {\n          allChecked = false;\n          return false; // Break out of the .each loop\n        }\n      });\n\n      // If any group has no radio selected, alert the user\n      if (!allChecked) {\n        e.preventDefault(); // Prevent the form from submitting\n        alert('Please select a delivery option before proceeding.');\n      }\n    });\n  }\n  function async_cart_products_update() {\n    // Prevent starting a new cart update if one triggered by this handler is already running\n    if (anarCartUpdateInProgress) {\n      console.log('Anar: Cart update already in progress, skipping new AJAX call.');\n      return;\n    }\n    console.log('Anar: Initiating async cart product update.');\n    $.ajax({\n      url: awca_ajax_object.ajax_url,\n      type: 'POST',\n      dataType: 'json',\n      data: {\n        action: 'anar_update_cart_products_async',\n        // New action name\n        nonce: awca_ajax_object.nonce // Use the same nonce\n      },\n      beforeSend: function beforeSend() {\n        // Optional: Show some subtle loading indicator near the order review?\n      },\n      success: function success(response) {\n        if (response.success) {\n          console.log('Anar: Cart product update check completed.', response.data);\n          // Check if the PHP handler indicated updates happened\n          if (response.data.needs_refresh === true) {\n            console.log('Anar: Product updates occurred, triggering checkout refresh.');\n            // Set the flag to indicate we are about to trigger the update\n            anarCartUpdateInProgress = true;\n            // Trigger the standard WooCommerce checkout update\n            $(document.body).trigger('update_checkout');\n            // Reset the flag shortly after, allowing subsequent user actions to trigger updates\n            // Or reset it when the *next* updated_checkout event fires (handled implicitly by the check at the start)\n            // Let's reset after a small delay for safety\n            setTimeout(function () {\n              anarCartUpdateInProgress = false;\n            }, 500); // Reset after 500ms\n          } else {\n            console.log('Anar: No product updates needed refresh.');\n          }\n        } else {\n          console.error('Anar: Cart product update check failed.', response.data ? response.data.message : 'No error message provided.');\n        }\n      },\n      error: function error(xhr, status, _error) {\n        console.error('Anar: AJAX error during cart product update.', status, _error, xhr.responseText);\n        // Ensure flag is reset on error too\n        anarCartUpdateInProgress = false;\n      },\n      complete: function complete() {\n        console.log('Anar: Async cart product update call complete.');\n        // Optional: Hide loading indicator\n        // We don't reset the flag here, only after triggering update_checkout or on error\n      }\n    });\n  }\n\n  // Flag to prevent immediate re-triggering of checkout update by our own AJAX call\n  var anarCartUpdateInProgress = false;\n\n  // Execute functions on WooCommerce updated_checkout event\n  $(document.body).on('updated_checkout', function () {\n    console.log('Anar: updated_checkout event triggered.');\n\n    // Existing functions for delivery options\n    ensureRadioSelection();\n    validateRadioSelectionOnOrder();\n    async_cart_products_update();\n  });\n\n  // Ensure one radio is selected and validation on first load\n  ensureRadioSelection();\n  validateRadioSelectionOnOrder();\n  var anarOrderDetails = $('#anar-order-details-front');\n  if (anarOrderDetails.length !== 0) {\n    var loadingIcon = anarOrderDetails.find('.spinner-loading');\n    var OrderID = anarOrderDetails.data('order-id');\n    var msgType = 'error';\n    jQuery.ajax({\n      url: awca_ajax_object.ajax_url,\n      type: \"POST\",\n      dataType: \"json\",\n      data: {\n        order_id: OrderID,\n        action: 'awca_fetch_order_details_public_ajax'\n      },\n      beforeSend: function beforeSend() {\n        loadingIcon.show();\n      },\n      success: function success(response) {\n        if (response.success) {\n          anarOrderDetails.html(response.data.output);\n        }\n      },\n      error: function error(xhr, status, err) {\n        anarOrderDetails.text(xhr.responseText);\n        loadingIcon.hide();\n      },\n      complete: function complete() {\n        loadingIcon.hide();\n      }\n    });\n  }\n\n  // Async Product Update AJAX Call\n  // Find the meta tag added by PHP\n  var metaTag = $('meta[name=\"anar-product-id\"]');\n  var productId = null;\n  if (metaTag.length > 0) {\n    productId = metaTag.attr('content');\n  }\n\n  // Proceed only if the meta tag and a valid product ID were found\n  if (productId && !isNaN(productId)) {\n    // Check if it's a number\n    productId = parseInt(productId, 10); // Ensure it's an integer\n    console.log('Anar: Found product ID ' + productId + ' from meta tag. Initiating async update.');\n    // Optional: You could show a loading indicator here if needed\n\n    $.ajax({\n      url: awca_ajax_object.ajax_url,\n      // From wp_localize_script\n      type: 'POST',\n      dataType: 'json',\n      // Expecting a JSON response from the server\n      data: {\n        action: 'anar_update_product_async',\n        // Matches the PHP handler\n        product_id: productId,\n        nonce: awca_ajax_object.nonce // Use the nonce provided for public AJAX calls\n      },\n      success: function success(response) {\n        if (response.success && response.data) {\n          // --- TODO: Update your product page elements here ---\n          // Example: Update price, stock status, etc., based on response.data\n          // e.g., $('.product_title').text(response.data.new_title);\n          // e.g., $('.price').html(response.data.new_price_html);\n          console.log('Anar: Product update successful.', response.data);\n          // --- End TODO ---\n        } else {\n          // Handle cases where the AJAX action succeeded but the operation failed\n          console.error('Anar: Product update failed.', response.data ? response.data.message : 'No error message provided.');\n        }\n      },\n      error: function error(xhr, status, _error2) {\n        // Handle AJAX communication errors\n        console.error('Anar: AJAX error during product update.', status, _error2, xhr.responseText);\n      },\n      complete: function complete() {\n        // Optional: Hide loading indicator here\n        console.log('Anar: Async product update call complete.');\n      }\n    });\n  } else {\n    // Log if the meta tag wasn't found or didn't contain a valid ID\n    // This will now run on non-product pages as well, but that's fine.\n    console.log('Anar: Could not find valid product ID meta tag on this page for async update.');\n  }\n});\n\n//# sourceURL=webpack://wp-anar/./assets/js/public.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./assets/js/public.js"]();
/******/ 	
/******/ })()
;